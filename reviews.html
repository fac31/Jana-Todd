<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>See what our customers have said!</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <nav class='buttonsDiv'>
    <a class="welcome" href="index.html">Welcome</a>
    <a class="reviews" href="reviews.html">Reviews</a>
    <a class="packages" href="packages.html">Packages</a>
    <a class="travelEquipment" href="travelEquipment.html">Travel Equipment</a>
  </nav>
  <main>
    <h1>See what our customers say.</h1>
    <!-- content will be inserted here by script -->
  </main>
  <section>
    <form id="textForm">
      <h3>Leave a review</h3>

      <label for="name">Full Name:
        <input id="name" name="name" type="text" required>
      </label>

      <label for="rating">Rating:
        <input id="rating" name="rating" type="number" required>
      </label>

      <label for="comment">Your Comment:
        <textarea id="comment" name="comment" rows="4" cols="50"></textarea>
      </label>
      <input type="submit" value="Submit" class="btn">
    </form>
  </section>

<script type="module">
  import reviews from "./reviewData.js"
  const form = document.getElementById("textForm")
  const main = document.querySelector("main")

  const collectFormData = (e) => {
    const data = {}
    // convert HTMLformcollection into array and remove the final element (submit button)
    let elements = [...e.target.elements].slice(0,-1)
    try {
      elements.forEach(({ name, value }) => {
        // for each element, create a key value pair in data from the name and value attributes
        // TODO: sanitise input
        data[name] = value
      })
    } catch (error) {
      console.error(error)
    }
    return data
  }

  const appendNewReview = (data) => {
    const htmlString = `<div class="reviewHeader">
      <img src="">
      <h4>${data.name}</h4>
      <div class="starRating">
        <i>${new Array(parseInt(data.rating)).fill("*").join("")}</i>
        </div></div>
        <p>${data.comment}</p>`;
      const newReview = document.createElement("div")
      newReview.classList.add("review")
      newReview.innerHTML = htmlString
      main.appendChild(newReview)
  }

  reviews.forEach(r => appendNewReview(r))

  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const data = collectFormData(e)
    appendNewReview(data)
  })
</script>
</body>

</html>
